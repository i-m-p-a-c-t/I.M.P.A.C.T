<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>User</title>
  <!--="{{ url_for('static', filename='css/sb-admin.css') }}"-->
  <!-- Custom fonts for this template-->
  <link href="{{ url_for('static', filename='vendor/fontawesome-free/css/all.min.css') }}" rel="stylesheet" type="text/css">

  <!-- Page level plugin CSS-->
  <link href="{{ url_for('static', filename='vendor/datatables/dataTables.bootstrap4.css') }}" rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="{{ url_for('static', filename='css/sb-admin.css') }}" rel="stylesheet">
  <link rel="SHORTCUT ICON"
       href="{{ url_for('static', filename='img/logo.png') }}">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
  
</head>

<body id="page-top">

  <nav class="navbar navbar-expand navbar-dark bg-dark static-top">

    <a class="navbar-brand mr-1" href="index.html">I.M.P.A.C.T</a>

    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Navbar Search -->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
        <div class="input-group-append">
          <button class="btn btn-primary" type="button">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </form>

    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">
      <li class="nav-item dropdown no-arrow mx-1">
        <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-bell fa-fw" id = "alertBadge"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">
          <a class="dropdown-item" href="#" id = "locate" >Locate</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item dropdown no-arrow mx-1">
        <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-envelope fa-fw"></i>
          <span class="badge badge-danger"></span>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="messagesDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item dropdown no-arrow">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          <a class="dropdown-item" href="#">Settings</a>
          <a class="dropdown-item" href="#">Activity Log</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
        </div>
      </li>
    </ul>

  </nav>

  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="sidebar navbar-nav">
      <li class="nav-item">
       
        <a class="nav-link" href="/dashboard">
 	  <span>{{ name }}</span>
          <br/>
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item dropdown">
		<a class="nav-link" href="/user">
          <i class="fas fa-user-circle fa-fw"></i>
          <span>User</span>
        </a>
        <!-- <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> -->
          <!-- <i class="fas fa-fw fa-folder"></i> -->
          <!-- <span>Pages</span> -->
        <!-- </a> -->
        <!-- <div class="dropdown-menu" aria-labelledby="pagesDropdown"> -->
          <!-- <div class="dropdown-divider"></div> -->
          <!-- <a class="dropdown-item" href="/forgot-password">Forgot Password</a> -->
          <!-- <div class="dropdown-divider"></div> -->
          <!-- <h6 class="dropdown-header">Other Pages:</h6> -->
          <!-- <a class="dropdown-item active" href="/user">User Page</a> -->
        <!-- </div> -->
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/charts">
          <i class="fas fa-fw fa-chart-area"></i>
          <span>Charts</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/tables">
          <i class="fas fa-fw fa-table"></i>
          <span>Tables</span></a>
      </li>
    </ul>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/user">Dashboard</a>
          </li>
          <li class="breadcrumb-item active">User Info</li>
        </ol>

        <!-- Page Content -->
        <h1>User Page</h1>
        <hr>
        <div class="container-fluid">
            <div class="row">
              <div class="col-sm">
                <div class="card mb-3" style = "width: 32em">
                  <div class="card-header">
                    <i class="fas fa-tachometer-alt"></i>
                    Speed</div>
                  <div class="card-body">
                    Current speed is: <b>30mph</b>
                  </div>
            </div>
          </div>
            <div class="col-sm">
              <div class="card mb-3" style = "width: 32em">
                <div class="card-header">
                  <i class="fas fa-exclamation-triangle"></i>
                    Safety</div>
                <div class="card-body">
		  
		   <b id="safety_status"> yes </b>
                </div>
            </div>
          </div>
            <div class="col-sm">
              <div class="card mb-3" style = "width: 32em">
                <div class="card-header">
                  <i class="far fa-compass"></i>
                  Direction</div>
                <div class="card-body">
                  <b>North/East/Sound/West</b>
                </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="card mb-3" style = "width: 102em">
            <div class="card-header">
                <i class="fas fa-map"></i>
                  Map</div>
            <div class="card-body">
              <div id="myMap" style="width:100%;height:400px;"></div>
            </div>
        </div>
        </div>
        <div class="row">
          <div class="col-sm">
            <div class="card mb-3" style = "width: 32em">
              <div class="card-header">
                <i class="fas fa-shield-alt"></i>
                Current Mood</div>
              <div class="card-body" id = "currentMood">
                neutral
              </div>
        </div>
      </div>
        <div class="col-sm">
          <div class="card mb-3" style = "width: 32em">
            <div class="card-header">
              <i class="fas fa-exclamation-triangle"></i>
                Health/Benefit</div>
            <div class="card-body">
              Something
            </div>
        </div>
      </div>
        <div class="col-sm">
          <div class="card mb-3" style = "width: 32em">
            <div class="card-header">
              <i class="fas fa-medkit"></i>
              Health Coverage</div>
            <div class="card-body">
              Type of Health Coverage
            </div>
        </div>
      </div>
    </div>
      </div>
      <!-- /.container-fluid -->

      <!-- Sticky Footer -->
      <footer class="sticky-footer">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright © Your Website 2019</span>
          </div>
        </div>
      </footer>

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="/logout">Logout</a>
        </div>
      </div>
    </div>
  </div>
  
  
    <div id="my-modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
	       
                <div class="modal-header" style="padding:9px 15px;
     border-bottom:1px solid #eee;
     background-color: #0480be;">
		    <h4 class="modal-title">Danger</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               
                </div>
                <div class="modal-body">
                   Car is flipped!
		   Calling emergency...
                </div>
            </div>
        </div> 
    </div>

  
  <!--"{{ url_for('static', filename='js/sb-admin.min.js') }}"-->
  <!-- Bootstrap core JavaScript-->
  <script src="{{ url_for('static', filename='vendor/jquery/jquery.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

  <!-- Core plugin JavaScript-->
  <script src="{{ url_for('static', filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>
<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
  <script type='text/javascript'>
	var map;

    //Query URL to the NAVTEQ POI data source
    var sdsDataSourceUrl = 'https://spatial.virtualearth.net/REST/v1/data/f22876ec257b474b82fe2ffcb8393150/NavteqNA/NavteqPOIs';
    function GetMap() {
        map = new Microsoft.Maps.Map('#myMap', {});
     
        var loc = new Microsoft.Maps.Location(47.246857, -122.431999);
        //Add a pushpin at the user's location.
        
        var pin = new Microsoft.Maps.Pushpin(loc);
        map.entities.push(pin);

        //Center the map on the user's location.
        map.setView({ center: loc, zoom: 15});
        //Load the Bing Spatial Data Services module.
        Microsoft.Maps.loadModule('Microsoft.Maps.SpatialDataService', function () {
            //Add an event handler for when the map moves.
            Microsoft.Maps.Events.addHandler(map, 'viewchangeend', getNearByLocations);

            
            getNearByLocations();
        });
    }

    function getNearByLocations() {
        //Remove any existing data from the map.
        map.entities.clear();

        //Create a query to get nearby data.
        var queryOptions = {
            queryUrl: sdsDataSourceUrl,
            spatialFilter: {
                spatialFilterType: 'nearby',
                location: map.getCenter(),              
                radius: 25
            },
            //Filter to retrieve Gas Stations.
            filter: new Microsoft.Maps.SpatialDataService.Filter('EntityTypeID','eq',8060) 
        };

        //Process the query.
        Microsoft.Maps.SpatialDataService.QueryAPIManager.search(queryOptions, map, function (data) {
            //Add results to the map.
            map.entities.push(data);
        });
    }
	
  </script>
  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AkcVlljdzqOR2jwA9JCCdgCKsAk9V8ZBiAlQd-JHVbfqcO9Rx-fjLHDzugFiCkCP' async defer></script>


  

  <script type='text/javascript'>
	
	var alertBadge = document.getElementById("alertBadge");
	var alertDropDown = document.getElementById("alertsDropdown");
	
	alertDropDown.addEventListener('click', function() {
		alertBadge.innerHTML = "";
	});
		
	
	var safety_status;
	var current_mood;
	var source = new EventSource('/stream');
	source.onmessage = function(event) {
		<!-- var data = JSON.parse(event.data); -->
		var data = event.data.split(",");
		status = data[0];
		data = data[1];
		//alert(status + " " + data);
		
		updateSafetyStatus(status);
		updateCurrentMood(data);
		
		
		
	      
	};
	
	
	function updateSafetyStatus(safety_status) {
		var content = document.getElementById("safety_status");
		var isCalling = false;
		if (safety_status === "no") {
		  $("#my-modal").modal("show");
		 // alert("David is dead!");
		}
	      
		if (content.innerText !== safety_status && safety_status !== "") {
			content.innerHTML = safety_status;
			
		} 
		
		if (content.innerText === "no" && !isCalling) {
			
			if (alertBadge.innerText === "") {
				alertBadge.innerHTML = 1;
			} else {
				alertBadge.innerHTML = parseInt(alertBadge.innerText) + 1;
			}
			//contactHelp();
			isCalling = true; 
		} else if (content.innerText === "yes") {
			isCalling = false;
		}
	}
	
	function updateCurrentMood(current_mood) {
		var contentMood = document.getElementById("currentMood");
		if (contentMood.innerText !== current_mood && current_mood !== "") { 
			contentMood.innerHTML = current_mood;
		}
	}
	
	
	<!-- var content = document.getElementById("safety_status"); -->
	<!-- var isCalling = false; -->
	<!-- function getSafetyStatus() { -->
  	   <!-- var req = new XMLHttpRequest(); -->
	   	
	   <!-- req.onreadystatechange = function() { -->
		
		<!-- if (content.innerText !== this.responseText && this.responseText !== "") { -->
			<!-- document.getElementById("safety_status").innerHTML = this.responseText; -->
		<!-- }  -->
		
		<!-- return; -->
	   <!-- } -->
	   <!-- req.open('GET', 'http://127.0.0.1:5000/get_safety_status', true); -->
	   <!-- req.send(); -->
	   <!-- if (content.innerText === "no" && !isCalling) { -->
		
		<!-- if (alertBadge.innerText === "") { -->
			<!-- alertBadge.innerHTML = 1; -->
		<!-- } else { -->
			<!-- alertBadge.innerHTML = parseInt(alertBadge.innerText) + 1; -->
		<!-- } -->
		<!-- contactHelp(); -->
		<!-- isCalling = true; -->
	   <!-- } else if (content.innerText === "yes") { -->
		<!-- isCalling = false; -->
	   <!-- } -->
	<!-- }  -->
	
	
	<!-- var contentMood = document.getElementById("currentMood"); -->
	<!-- function getCurrentMood() { -->
  	   <!-- var req = new XMLHttpRequest(); -->
	   	
	   <!-- req.onreadystatechange = function() { -->
		
		<!-- if (contentMood.innerText !== this.responseText && this.responseText !== "") { -->
			<!-- contentMood.innerHTML = this.responseText; -->
		<!-- }  -->
		<!-- //alert("updated"); -->
		<!-- return; -->
	   <!-- } -->
	   <!-- req.open('GET', 'http://127.0.0.1:5000/get_current_mood', true); -->
	   <!-- req.send(); -->
	   
	<!-- }  -->
	
	<!-- var myVar = setInterval(function() { -->
	   <!-- getSafetyStatus(); -->
	   <!-- getCurrentMood();	 -->
	
	<!-- }, 500); -->
	
	function contactHelp() {
	   <!-- var req = new XMLHttpRequest(); -->
	   <!-- req.open('GET', 'http://127.0.0.1:5000/contact_help', true); -->
	   <!-- req.send(); -->
	   alert("Contacting...");
	}	
	

  </script>

 <!-- Custom scripts for all pages-->
  <script src="{{ url_for('static', filename='js/sb-admin.min.js') }}"></script>

</body>

</html>
